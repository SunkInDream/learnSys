{"ast":null,"code":"import React,{useEffect}from'react';import{Form,Input,Button,Card,message}from'antd';import{UserOutlined,LockOutlined}from'@ant-design/icons';import{useNavigate}from'react-router-dom';import'./index.less';import request from'../../utils/request';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=()=>{const navigate=useNavigate();// 修改这里的登录状态检查逻辑\nuseEffect(()=>{// 只在组件挂载时检查一次登录状态\nconst checkLoginStatus=()=>{const isLoggedIn=localStorage.getItem('isLoggedIn')==='true';if(isLoggedIn){navigate('/',{replace:true});}};// 确保在退出登录后清除了登录状态\nconst loginStatus=localStorage.getItem('isLoggedIn');if(!loginStatus||loginStatus==='false'){localStorage.removeItem('isLoggedIn');}checkLoginStatus();},[]);// eslint-disable-line react-hooks/exhaustive-deps\nconst onFinish=async values=>{try{const response=await request.post('/api/auth/login',values);if(response.data.success){localStorage.setItem('token',response.data.token);localStorage.setItem('user',JSON.stringify(response.data.user));message.success('登录成功！');navigate('/');}}catch(error){var _error$response,_error$response$data;message.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'登录失败');}};return/*#__PURE__*/_jsx(\"div\",{className:\"login-container\",children:/*#__PURE__*/_jsx(Card,{className:\"login-card\",title:\"\\u5B66\\u4E60\\u52A9\\u624B\",children:/*#__PURE__*/_jsxs(Form,{name:\"login\",onFinish:onFinish,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"username\",rules:[{required:true,message:'请输入用户名！'}],children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{}),placeholder:\"\\u7528\\u6237\\u540D\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"password\",rules:[{required:true,message:'请输入密码！'}],children:/*#__PURE__*/_jsx(Input.Password,{prefix:/*#__PURE__*/_jsx(LockOutlined,{}),placeholder:\"\\u5BC6\\u7801\"})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",block:true,children:\"\\u767B\\u5F55\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-links\",children:[/*#__PURE__*/_jsx(\"a\",{onClick:()=>navigate('/register'),children:\"\\u6CE8\\u518C\\u8D26\\u53F7\"}),/*#__PURE__*/_jsx(\"a\",{children:\"\\u5FD8\\u8BB0\\u5BC6\\u7801\\uFF1F\"})]})]})})});};export default Login;","map":{"version":3,"names":["React","useEffect","Form","Input","Button","Card","message","UserOutlined","LockOutlined","useNavigate","request","jsx","_jsx","jsxs","_jsxs","Login","navigate","checkLoginStatus","isLoggedIn","localStorage","getItem","replace","loginStatus","removeItem","onFinish","values","response","post","data","success","setItem","token","JSON","stringify","user","error","_error$response","_error$response$data","className","children","title","name","Item","rules","required","prefix","placeholder","Password","type","htmlType","block","onClick"],"sources":["/home/gnahz/Documents/learning_msys/frontpages/src/pages/Login/index.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { Form, Input, Button, Card, message } from 'antd';\r\nimport { UserOutlined, LockOutlined } from '@ant-design/icons';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './index.less';\r\nimport request from '../../utils/request';\r\n\r\nconst Login = () => {\r\n  const navigate = useNavigate();\r\n  \r\n  // 修改这里的登录状态检查逻辑\r\n  useEffect(() => {\r\n    // 只在组件挂载时检查一次登录状态\r\n    const checkLoginStatus = () => {\r\n      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';\r\n      if (isLoggedIn) {\r\n        navigate('/', { replace: true });\r\n      }\r\n    };\r\n    \r\n    // 确保在退出登录后清除了登录状态\r\n    const loginStatus = localStorage.getItem('isLoggedIn');\r\n    if (!loginStatus || loginStatus === 'false') {\r\n      localStorage.removeItem('isLoggedIn');\r\n    }\r\n    \r\n    checkLoginStatus();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const onFinish = async (values) => {\r\n    try {\r\n      const response = await request.post('/api/auth/login', values);\r\n      if (response.data.success) {\r\n        localStorage.setItem('token', response.data.token);\r\n        localStorage.setItem('user', JSON.stringify(response.data.user));\r\n        message.success('登录成功！');\r\n        navigate('/');\r\n      }\r\n    } catch (error) {\r\n      message.error(error.response?.data?.message || '登录失败');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-container\">\r\n      <Card className=\"login-card\" title=\"学习助手\">\r\n        <Form\r\n          name=\"login\"\r\n          onFinish={onFinish}\r\n        >\r\n          <Form.Item\r\n            name=\"username\"\r\n            rules={[{ required: true, message: '请输入用户名！' }]}\r\n          >\r\n            <Input \r\n              prefix={<UserOutlined />} \r\n              placeholder=\"用户名\" \r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"password\"\r\n            rules={[{ required: true, message: '请输入密码！' }]}\r\n          >\r\n            <Input.Password\r\n              prefix={<LockOutlined />}\r\n              placeholder=\"密码\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\" block>\r\n              登录\r\n            </Button>\r\n          </Form.Item>\r\n          \r\n          <div className=\"login-links\">\r\n            <a onClick={() => navigate('/register')}>注册账号</a>\r\n            <a>忘记密码？</a>\r\n          </div>\r\n        </Form>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}